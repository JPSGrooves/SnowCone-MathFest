(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();const _="snowcone_save_data";function i(){const e=localStorage.getItem(_);try{return e?JSON.parse(e):y()}catch(t){return console.error("ğŸ’¥ Failed to parse stored data:",t),y()}}function L(e){localStorage.setItem(_,JSON.stringify(e))}function E(e){var t;return(t=i().settings)==null?void 0:t[e]}function f(e,t){const n=i();n.settings[e]=t,L(n)}function y(){return{profile:{username:"Guest",xp:0,level:1,badges:[],completedModes:[],lastPlayed:null,seenIntro:!1},settings:{theme:"menubackground",mute:!1,difficulty:"normal"},stats:{quickServe:{sessions:0,topScore:0},infinity:{timeSpent:0},story:{chapter:0}},storyProgress:{currentChapter:0,seenPanels:[]},created:Date.now()}}window.devFlags={build:"v0.1.9"};function S(){var s;const e=document.getElementById("menuImage");if(!e){console.warn("ğŸ§ No menuImage element found!");return}let n=(s=i().settings)==null?void 0:s.theme;(!n||typeof n!="string"||n==="default")&&(n="menubackground",f("theme",n)),e.src=`assets/img/branding/${n}.png`,console.log("ğŸ§Š Background set to:",n),P(n)}function P(e){const t=$[e];t&&Object.entries(t).forEach(([n,s])=>{const o=document.querySelector(`.menu-label.${n}`);o&&(o.style.color=s)})}function O(e){const t=document.getElementById("menuImage");if(!t){console.warn("ğŸš¨ No #menuImage found to swap.");return}typeof f=="function"&&f("theme",e),t.src=`assets/img/branding/${e}.png`,console.log(`ğŸŒŒ Swapped to theme: ${e}`)}window.swapBackground=O;const $={menubackground:{kids:"#ff77ff",quick:"#00ffee",tips:"#ffee00",story:"#ff4488",infinity:"#88ccff",options:"#cccccc"},spring:{kids:"#cc66ff",quick:"#00cc99",tips:"#ffcc66",story:"#ff66aa",infinity:"#66ddff",options:"#9999cc"},summer:{kids:"#ffdd00",quick:"#ff6600",tips:"#33cc33",story:"#ff3399",infinity:"#00ddff",options:"#ff9933"},fall:{kids:"#ffaa00",quick:"#ff6600",tips:"#66cc33",story:"#cc6633",infinity:"#ffffff",options:"#663300"},winter:{kids:"#aaddff",quick:"#ffffff",tips:"#66ffff",story:"#ddddff",infinity:"#66ccff",options:"#ccccff"},freedom:{kids:"#ff4444",quick:"#ffffff",tips:"#3366ff",story:"#ffcc00",infinity:"#bbbbbb",options:"#222222"},halloween:{kids:"#ff9933",quick:"#6600cc",tips:"#00cc66",story:"#cc0000",infinity:"#dddddd",options:"#000000"},harvest:{kids:"#ffcc00",quick:"#996633",tips:"#cc9900",story:"#993300",infinity:"#ffffff",options:"#333300"},christmas:{kids:"#00dd00",quick:"#dd0000",tips:"#ffffff",story:"#ff66cc",infinity:"#aaaaaa",options:"#006600"},newyear:{kids:"#ffffff",quick:"#ffcc00",tips:"#999999",story:"#330066",infinity:"#ff00ff",options:"#111111"},valentine:{kids:"#ff6699",quick:"#cc0066",tips:"#ffcccc",story:"#990033",infinity:"#ffe6f0",options:"#660033"},cosmic_01:{kids:"#cc66ff",quick:"#00ffff",tips:"#ffcc00",story:"#ff6699",infinity:"#ffffff",options:"#9999ff"},cosmic_02:{kids:"#ff99cc",quick:"#33ccff",tips:"#ccff66",story:"#ff66cc",infinity:"#cccccc",options:"#6666ff"},cosmic_03:{kids:"#ffffff",quick:"#88ffcc",tips:"#00cc99",story:"#66ccff",infinity:"#ccffff",options:"#333399"},cosmic_04:{kids:"#aaffff",quick:"#ffffff",tips:"#66ccff",story:"#99ccff",infinity:"#33ccff",options:"#005577"},cosmic_05:{kids:"#ffcc00",quick:"#ff9900",tips:"#00ffff",story:"#ff33cc",infinity:"#ffffff",options:"#ff0066"},cosmic_06:{kids:"#000000",quick:"#ff0000",tips:"#ffccff",story:"#330033",infinity:"#ff99ff",options:"#9900cc"},cosmic_07:{kids:"#ffffff",quick:"#ffffff",tips:"#ffffff",story:"#ffffff",infinity:"#ffffff",options:"#ffffff"}},v={menubackground:"ğŸŒŒ Default",fall:"ğŸ‚ Fall",winter:"â„ï¸ Winter",spring:"ğŸŒ¸ Spring",summer:"â˜€ï¸ Summer",halloween:"ğŸƒ Halloween",harvest:"ğŸŒ½ Harvest",christmas:"ğŸ„ Christmas",freedom:"ğŸ† Freedom",newyear:"ğŸŠ New Year",valentine:"ğŸ’˜ Valentine",cosmic_01:"ğŸŒ€ Cosmic 01",cosmic_02:"ğŸŒ€ Cosmic 02",cosmic_03:"ğŸŒ€ Cosmic 03",cosmic_04:"ğŸŒ€ Cosmic 04",cosmic_05:"ğŸŒ€ Cosmic 05",cosmic_06:"ğŸŒ€ Cosmic 06",cosmic_07:"ğŸŒ€ Aberyâ€™s Cone"};window.setTheme=e=>{f("theme",e),S()};function C(){const e=document.getElementById("infoModal");e&&(e.classList.remove("hidden"),e.style.display="flex")}function T(){const e=document.getElementById("infoModal");e&&(e.classList.add("hidden"),e.style.display="none")}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".menu-title-top");e?(console.log("ğŸ¯ Title found. Binding click."),e.addEventListener("click",()=>{console.log("ğŸ¯ Title click detected"),C()})):console.warn("âš ï¸ .menu-title-top not found!")});document.addEventListener("keydown",e=>{e.key==="Escape"&&T()});console.log("ğŸ§ infoModal.js loaded");window.openInfoModal=C;window.closeInfoModal=T;const M={first_steps:{label:"First ğŸ¦",short:"Get XP",png:"snowconebadge.png",unlocks:null},math_zen:{label:"Zen ğŸ§˜",short:"100 XP",png:"snowconebadge.png",unlocks:"cosmic_01"},mode_tour:{label:"Tour ğŸª",short:"Try Modes",png:"snowconebadge.png",unlocks:null},theme_swap:{label:"Style ğŸ¨",short:"Change Theme",png:"snowconebadge.png",unlocks:"summer"},listened_music:{label:"Vibes ğŸ§",short:"Play Music",png:"snowconebadge.png",unlocks:"cosmic_02"},kids_place_car:{label:"Grid ğŸš—",short:"Place Car",png:"snowconebadge.png",unlocks:"spring"},kids_match_master:{label:"Match ğŸ”¢",short:"Match Game",png:"snowconebadge.png",unlocks:"freedom"},quick_50:{label:"QS 50 âš¡",short:"QS: 50pts",png:"snowconebadge.png",unlocks:null},quick_100:{label:"QS 100 âš¡",short:"QS: 100pts",png:"snowconebadge.png",unlocks:"cosmic_03"},quick_200:{label:"QS 200 âš¡",short:"QS: 200pts",png:"snowconebadge.png",unlocks:"cosmic_07"},quick_300:{label:"QS 300 âš¡",short:"QS: 300pts",png:"snowconebadge.png",unlocks:"cosmic_05"},inf_50_1min:{label:"50 ğŸ”",short:"50 in 1m",png:"snowconebadge.png",unlocks:"harvest"},inf_100_2min:{label:"100 ğŸ”",short:"100 in 2m",png:"snowconebadge.png",unlocks:"winter"},inf_250_4min:{label:"250 ğŸ”",short:"250 in 4m",png:"snowconebadge.png",unlocks:"christmas"},inf_600_10min:{label:"600 ğŸ”",short:"600 in 10m",png:"snowconebadge.png",unlocks:"valentine"},story_started:{label:"Enter ğŸ“–",short:"Start Story",png:"snowconebadge.png",unlocks:null},story_finished:{label:"Clear ğŸŒ²",short:"Finish Story",png:"snowconebadge.png",unlocks:"fall"},story_perfect:{label:"Perfect âœ”ï¸",short:"No Mistakes",png:"snowconebadge.png",unlocks:"cosmic_06"},story_cat:{label:"Cat ğŸ±",short:"Find Cat",png:"snowconebadge.png",unlocks:"newyear"},story_phil:{label:"Phil ğŸ‘½",short:"Meet Phil",png:"snowconebadge.png",unlocks:"halloween"},legend:{label:"Legend ğŸ†",short:"100% Game",png:"snowconebadge.png",unlocks:"cosmic_04"}};function x(){const e=document.getElementById("badgeGrid"),t=i();if(!e)return;e.innerHTML="";const n={"ğŸŒ Core Progress":["first_steps","math_zen","mode_tour","theme_swap","listened_music"],"ğŸ§¸ Kids Cones":["kids_place_car","kids_match_master"],"âš¡ Quick Serve":["quick_50","quick_100","quick_200","quick_300"],"ğŸ® Infinity Mode":["inf_50_1min","inf_100_2min","inf_250_4min","inf_600_10min"],"ğŸ§  Story Mode":["story_started","story_finished","story_perfect","story_cat","story_phil"],"ğŸ† Completion":["legend"]};for(const[s,o]of Object.entries(n)){const c=document.createElement("div");c.classList.add("badge-group");const a=document.createElement("div");a.classList.add("badge-section"),a.textContent=s,c.appendChild(a);const d=document.createElement("div");d.classList.add("badge-grid"),o.forEach(p=>{var k;const u=M[p],r=document.createElement("div");r.classList.add("badge-tile");const h=(k=t.profile.badges)==null?void 0:k.includes(p),m=document.createElement("img");m.classList.add("badge-img"),m.src=h?`/SnowCone-MathFest/assets/img/icons/${u.png}`:"/SnowCone-MathFest/assets/img/icons/cone_locked.png",m.alt=u.label,r.appendChild(m);const g=document.createElement("div");if(g.classList.add("badge-short"),g.textContent=u.short||"?????",r.appendChild(g),h){const b=document.createElement("div");b.classList.add("badge-label"),b.textContent=u.label,r.appendChild(b),r.classList.add("unlocked")}d.appendChild(r)}),c.appendChild(d),e.appendChild(c)}}function A(){return`
    <div class="settings-block">
      <label for="profileNameInput">ğŸ§‘â€ğŸš€ Your Name:</label>
      <input id="profileNameInput" type="text" placeholder="Enter name..." />
    </div>

    <div class="settings-block">
      <h3>ğŸ“ˆ Completion</h3>
      <div class="xp-bar-wrap">
        <div class="xp-bar" id="xpBar"></div>
      </div>
      <span id="xpPercentText">0%</span>
    </div>

    <div class="settings-block">
      <h3>ğŸ… Cones Earned</h3>
      <div id="badgeGrid" class="badge-wrapper"></div>
    </div>

    <div class="settings-block">
      <h3>ğŸ“² App Info</h3>
      <p>This app works offline after install!<br>To save your data, donâ€™t clear site storage.</p>
      <p>If you want to install as an app:<br>Look for the browserâ€™s install option or PWA banner.</p>
    </div>
  `}function D(){const e=Object.keys(M).length,t=N(e),n=document.getElementById("xpBar"),s=document.getElementById("xpPercentText");n&&(n.style.width=`${t}%`),s&&(s.textContent=`${t}%`)}function F(){const e=document.getElementById("profileNameInput");e&&(e.value=i().profile.username,e.addEventListener("change",()=>{const t=i();t.profile.username=e.value.trim(),L(t)})),D(),x()}function N(e){const t=i();let n=0;return n+=Math.min(t.profile.xp,100)*.5,n+=t.profile.badges.length/e*20,t.stats.story.chapter>=5&&(n+=15),t.stats.quickServe.topScore>=50&&(n+=10),t.stats.quickServe.sessions>0&&t.stats.infinity.timeSpent>0&&t.storyProgress.seenPanels.length>0&&(n+=5),Math.min(100,Math.round(n))}function j(){var o;const e=i(),t=e.settings.theme,n=((o=e.profile)==null?void 0:o.unlockedThemes)||[];let s='<div class="theme-grid">';return Object.keys(v).forEach(c=>{const a=v[c],d=c==="menubackground"||n.includes(c);s+=`
      <div class="theme-tile ${d?"":"locked"} ${t===c?"active":""}" data-theme="${c}">
        <div class="theme-preview" style="background-image:url('assets/img/branding/${c}.png')"></div>
        <div class="theme-label">${a}</div>
        ${d?"":'<div class="theme-lock">ğŸ”’</div>'}
      </div>
    `}),s+="</div>",s}function G(){const e=document.querySelectorAll(".theme-tile");if(!e.length){console.warn("ğŸŒ€ No theme tiles found to bind");return}e.forEach(t=>{t.classList.contains("locked")||t.addEventListener("click",()=>{const n=t.dataset.theme;console.log(`ğŸ¨ Theme selected: ${n}`),f("theme",n),location.reload()})})}const U=[{id:"infinity_addition",label:"â™¾ï¸ Infinity Addition",src:"assets/audio/infinityaddition.mp3"}];let l=null;function Q(){return`
    <div class="settings-block">
      <label>
        <input type="checkbox" id="muteToggle" ${E("mute")?"checked":""} />
        ğŸ”‡ Mute all sound
      </label>
    </div>

    <div class="settings-block">
      <h3>ğŸ§ Tracks</h3>
      <div class="track-list">
        ${U.map(t=>`
          <button class="track-button" data-src="${t.src}">${t.label}</button>
        `).join("")}
      </div>
    </div>
  `}function H(){const e=document.getElementById("muteToggle");e&&e.addEventListener("change",()=>{const n=e.checked;f("mute",n),l&&(l.volume=n?0:1)}),document.querySelectorAll(".track-button").forEach(n=>{n.addEventListener("click",()=>{const s=n.dataset.src;l&&(l.pause(),l=null),l=new Audio(s),l.loop=!0,l.volume=E("mute")?0:1,l.play().catch(o=>{console.warn("ğŸ§ Playback failed:",o)})})})}function R(){var n;const e=((n=window==null?void 0:window.devFlags)==null?void 0:n.build)||"unknown",t=i();return JSON.stringify(t,null,2),`
    <div class="settings-block">
      <h3>ğŸ§  SnowCone MathFest v0.1.9</h3>
      <p><strong>Build:</strong> <code>${e}</code></p>
      <p>Crafted with cosmic cones ğŸ§</p>
    </div>

    <div class="settings-block">
      <h3>ğŸ“ Changelog</h3>
      <p>- Added modal tab system<br>
         - Profile, Themes, and Music tab now working<br>
         - Cosmic background persistence improved</p>
    </div>

    <div class="settings-block">
      <h3>ğŸ§° Tools</h3>
      <button class="track-button" id="downloadSave">â¬‡ï¸ Download Save</button>
      <button class="track-button" id="resetProgress">ğŸ—‘ï¸ Reset Progress</button>
    </div>
  `}function K(){const e=document.getElementById("downloadSave"),t=document.getElementById("resetProgress");e&&e.addEventListener("click",()=>{const n=new Blob([JSON.stringify(i(),null,2)],{type:"application/json"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download="snowcone_save_data.json",o.click(),URL.revokeObjectURL(s)}),t&&t.addEventListener("click",()=>{confirm("Reset all progress? This cannot be undone.")&&(localStorage.clear(),location.reload())})}function q(e="profile"){const t=document.getElementById("cosmicModal"),n=document.getElementById("cosmicOverlay");if(!t)return console.warn("ğŸ›‘ cosmicModal not found");t.classList.remove("hidden"),n==null||n.classList.remove("hidden"),n==null||n.classList.add("show"),B(e)}function I(){const e=document.getElementById("cosmicModal"),t=document.getElementById("cosmicOverlay");e&&e.classList.add("hidden"),t==null||t.classList.remove("show"),t==null||t.classList.add("hidden")}function B(e){const t=document.getElementById("modalContent");if(!t)return;switch(document.querySelectorAll(".tab-button").forEach(s=>{s.classList.toggle("active",s.dataset.tab===e)}),e){case"profile":t.innerHTML=A(),F();break;case"themes":t.innerHTML=j(),G();break;case"music":t.innerHTML=Q(),H();break;case"version":t.innerHTML=R(),K();break;default:t.innerHTML=`<p>Unknown tab: ${e}</p>`;break}const n=document.querySelector(".modal-close");n&&n.addEventListener("click",()=>{console.log("âŒ Cosmic modal closing!"),I()})}function V(e){const t=e.currentTarget.dataset.tab;console.log(`ğŸª Tab clicked: ${t}`),B(t)}function J(){var e;console.log("ğŸ§ª Setting up tab listeners..."),document.querySelectorAll(".tab-button").forEach(t=>{t.addEventListener("click",V)}),(e=document.querySelector(".label-options"))==null||e.addEventListener("click",()=>{console.log("âš™ï¸ Options clicked â€“ opening modal"),q("profile")})}document.addEventListener("DOMContentLoaded",()=>{J(),console.log("ğŸ§Š Cosmic modal listeners wired.")});window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".modal-close");e==null||e.addEventListener("click",()=>{console.log("âŒ Closing modal from global listener"),I()})});window.openModal=q;let w=0;document.addEventListener("touchend",e=>{const t=new Date().getTime();t-w<=300&&e.preventDefault(),w=t},!0);document.addEventListener("gesturestart",e=>{e.preventDefault()});console.log("ğŸ” VITE_SECRET_KEY:","radical123");document.addEventListener("DOMContentLoaded",()=>{S()});
